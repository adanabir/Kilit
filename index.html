<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tahta Kilit</title>
<style>
body { font-family: Arial; text-align:center; background:#f5f5f5; }
.box { margin-top:40px; }
input { font-size:30px; padding:10px; width:200px; text-align:center; }
button { font-size:24px; padding:10px 20px; }
.ok { color:green; font-weight:bold; }
.bad { color:red; font-weight:bold; }
</style>
</head>
<body>

<h1>ðŸ”’ TAHTA KÄ°LÄ°T</h1>
<p>QR okut â†’ kodu gir</p>

<div id="qrcode" class="box"></div>

<div class="box">
<input id="code" maxlength="6" placeholder="000000">
<button onclick="checkCode()">AÃ§</button>
<p id="msg"></p>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<script>
const SECRET = "OKUL-2026-XYZ"; // BURAYI DEÄžÄ°ÅžTÄ°R

function getChallenge(){
  return Math.floor(Date.now()/30000);
}

async function sha256(str){
  const buf = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(str));
  return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,"0")).join("");
}

async function generateCode(){
  const challenge = getChallenge();
  const hash = await sha256(SECRET + challenge);
  return (parseInt(hash.substring(0,8),16) % 1000000).toString().padStart(6,"0");
}

function makeQR(){
  const challenge = getChallenge();
  const url = "phone.html?c=" + challenge;
  new QRCode(document.getElementById("qrcode"), {
    text: url,
    width: 250,
    height: 250
  });
}

async function checkCode(){
  const expected = await generateCode();
  const input = document.getElementById("code").value;
  if(input === expected){
    document.getElementById("msg").innerHTML = "<span class='ok'>AÃ‡ILDI</span>";
  } else {
    document.getElementById("msg").innerHTML = "<span class='bad'>YanlÄ±ÅŸ Kod</span>";
  }
}

makeQR();
</script>

</body>
</html>
